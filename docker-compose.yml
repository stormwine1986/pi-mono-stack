services:
  redis:
    image: falkordb/falkordb:edge-alpine
    container_name: redis
    environment:
      - PORT=13000
      - REDIS_ARGS=--appendonly yes --dir /var/lib/falkordb/data
    volumes:
      - redis_data:/var/lib/falkordb/data
    restart: unless-stopped
    network_mode: host

  agent:
    build:
      context: pi-mono
      dockerfile: Dockerfile
      network: host
    image: pi-mono-agent:latest
    container_name: agent
    network_mode: host
    depends_on:
      - redis
    environment:
      - REDIS_URL=redis://127.0.0.1:6379
      - RCLONE_CONFIG_S3_TYPE=s3
      - RCLONE_CONFIG_S3_PROVIDER=Other
      - RCLONE_CONFIG_S3_ACCESS_KEY_ID
      - RCLONE_CONFIG_S3_SECRET_ACCESS_KEY
      - RCLONE_CONFIG_S3_ENDPOINT=https://pi.taileb0a7.ts.net:3900
    volumes:
      - ./.pi:/home/pi-mono/.pi
      - /var/run/docker.sock:/var/run/docker.sock
    restart: unless-stopped

  gateway:
    build:
      context: gateway
      dockerfile: Dockerfile
      network: host
    container_name: gateway
    depends_on:
      - redis
    restart: unless-stopped
    network_mode: host
    volumes:
      - ./.pi/agent/workspace:/home/pi-mono/.pi/agent/workspace:rw
    environment:
      - TELEGRAM_TOKEN
      - REDIS_URL=redis://127.0.0.1:6379
      - TG_ADMIN_ID=7722403902
      - DKRON_URL=http://127.0.0.1:18047/v1

  litellm:
    image: ghcr.io/berriai/litellm:main-v1.81.9-nightly
    container_name: litellm
    environment:
      - GEMINI_API_KEY
      - OPENROUTER_API_KEY
      - LANGFUSE_PUBLIC_KEY=pk-lf-493ce7f9-d1f6-4482-a658-fe4ac98da5c4
      - LANGFUSE_OTEL_HOST=https://us.cloud.langfuse.com
      - LANGFUSE_SECRET_KEY
    volumes:
      - ./.pi/agent/litellm.config.yaml:/app/config.yaml
    command: "--config /app/config.yaml"
    network_mode: host

  memsearch:
    build:
      context: memsearch
      dockerfile: Dockerfile
      network: host
    container_name: memsearch
    environment:
      - VOYAGE_API_KEY
      - REDIS_URL=redis://127.0.0.1:6379
    volumes:
      - ./.pi:/home/pi-mono/.pi
      - ./.pi/agent/memsearch.config.toml:/home/pi-mono/.memsearch/config.toml
    network_mode: host
    restart: unless-stopped

  dkron:
    build:
      context: dkron
      dockerfile: Dockerfile
      network: host
    container_name: dkron
    environment:
      - REDIS_URL=redis://127.0.0.1:6379
    volumes:
      - ./.pi/agent/workspace/.dkron:/dkron.data:rw
      - ./.pi/agent/workspace/.scheduler:/home/pi-mono/.pi/agent/workspace/.scheduler:rw
      - /var/run/docker.sock:/var/run/docker.sock
    network_mode: host
    restart: unless-stopped
    depends_on:
      - redis

  browser-use:
    build:
      context: browser-use
      dockerfile: Dockerfile
      network: host
    container_name: browser-use
    environment:
      - HOME=/home/pi-mono
    volumes:
      - ./.pi/agent/workspace:/home/pi-mono/.pi/agent/workspace
    labels:
      role: Tools
    network_mode: host
    restart: unless-stopped

  tavily:
    build:
      context: tavily
      dockerfile: Dockerfile
      network: host
    container_name: tavily
    environment:
      - TAVILY_API_KEY
    labels:
      role: Tools
    network_mode: host
    restart: unless-stopped

  github:
    build:
      context: github
      dockerfile: Dockerfile
      network: host
    container_name: github
    environment:
      - GITHUB_TOKEN
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./.pi/agent/workspace:/home/pi-mono/.pi/agent/workspace:rw
    labels:
      role: Tools
    network_mode: host
    restart: unless-stopped

  tradingview:
    build:
      context: tradingview
      dockerfile: Dockerfile
      network: host
    container_name: tradingview
    labels:
      role: Tools
    network_mode: host
    restart: unless-stopped

  polymarket:
    build:
      context: polymarket
      dockerfile: Dockerfile
      network: host
    container_name: polymarket
    labels:
      role: Tools
    network_mode: host
    restart: unless-stopped

  wikipedia:
    build:
      context: wikipedia
      dockerfile: Dockerfile
      network: host
    container_name: wikipedia
    labels:
      role: Tools
    network_mode: host
    restart: unless-stopped

  twitter:
    build:
      context: twitter
      dockerfile: Dockerfile
      network: host
    container_name: twitter
    environment:
      - TWITTERAPI_KEY
    labels:
      role: Tools
    network_mode: host
    restart: unless-stopped

  irm:
    build:
      context: irm
      dockerfile: Dockerfile
      network: host
    container_name: irm
    environment:
      - REDIS_URL=redis://127.0.0.1:6379
    volumes:
      - ./.pi/agent/workspace:/home/pi-mono/.pi/agent/workspace:rw
    labels:
      role: Tools
    network_mode: host
    restart: unless-stopped

volumes:
  redis_data: